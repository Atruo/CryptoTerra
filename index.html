<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Chat</title>
</head>
<style>
    .outer{
        width: 900px;
        margin: auto;
    }
    .room{
        width: 400px;
        margin: 5px;
        float: left;

    }
    .messages{
        width: 390px;
        margin:5px;
        height: 300px;
        background-color: aqua;
    }
    .txt-send{
        width: 300px;
        margin:5px;
    }

</style>
<body>
    <div class="outer">
        <div class="room">
            <h1>NODE</h1>
            <div>
              <h3>Usuarios del Chat:</h3>
              <span id="usuarios"></span>
            </div>
            <div class="messages" id="nMessages"></div>

                <input type="text" name="" id="nTxt" class="txt-send">
                <input type="button" value="Send" id="nBtn" class="btn">

        </div>

    </div>
    <script src="/socket.io/socket.io.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script>



    <script>
    //SOCKET.IO
        var socket = io();
        socket.on("connect", function(){
            var nRoom = "nRoom";
            socket.emit('nRoom', nRoom);
        });
    //NODE CRYPTO
    var ciphertext = CryptoJS.AES.encrypt('my message', 'secret key 123').toString();

  // Decrypt
  var bytes  = CryptoJS.AES.decrypt(ciphertext, 'secret key 123');
  var originalText = bytes.toString(CryptoJS.enc.Utf8);

  console.log(ciphertext); // 'my message'
        // NODE
        var nBtn = document.getElementById("nBtn");//Boton
        var nTxt = document.getElementById("nTxt");//Texto
        var nMessages = document.getElementById("nMessages");//Historial
        var usuarios = document.getElementById('usuarios');//Lista usuarios
        nTxt.addEventListener("keyup", function(event) {
          event.preventDefault();
          if (event.keyCode === 13) {//Si pulsamos enter se envia el mensaje
            document.getElementById("nBtn").click();
          }
        });
        nBtn.addEventListener("click", function(){//Si pinchamos en el bot√≥n
            socket.emit("node new message", nTxt.value);//Emitimos mensaje nuevo
            nTxt.value = '';//La casilla de escribir se vuelve en blanco
        });
        socket.on("node news", function(data){//Si hay un mensaje nuevo...
            nMessages.innerHTML = nMessages.innerHTML + "<br>" + data;//Agregamos el nuevo mensake al historial
        });
        socket.on("node new user", function(data){//Si hay un usuario nuevo....
            nMessages.innerHTML = nMessages.innerHTML + "<br>" + data;//Enviamos un texto diciendo que X usuario se ha unido
        });
        socket.on("actualizar usuarios", function(data){//Lista de usuarios
          var nombres = '';
            for (var i = 0; i < data.length; i++) {
              if (i==0) {
                nombres = data[i];
              }else{
                nombres += ', '+data[i];
              }

            }
            usuarios.innerHTML = nombres;//Enviamos un texto diciendo que X usuario se ha unido
        });

    </script>
</body>
</html>
